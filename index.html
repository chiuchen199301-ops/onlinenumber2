<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用電設備檢驗 - 雙櫃檯系統</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { margin: 0; font-family: system-ui, sans-serif; background: #1a1a1a; color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; text-align: center; }
        
        /* 網頁表頭 */
        .header {
            width: 100%; background: #2d2d2d; padding: 15px 0; font-size: 1.5rem; font-weight: bold; color: #00ff88;
            border-bottom: 3px solid #00ff88; letter-spacing: 4px; box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        .container { width: 100%; max-width: 600px; padding: 20px; flex: 1; display: flex; flex-direction: column; justify-content: center; }

        /* 雙櫃檯並列顯示區域 */
        .display-board { display: flex; gap: 20px; justify-content: center; margin: 20px 0; }
        .counter-card {
            flex: 1; background: #262626; padding: 20px; border-radius: 15px; border: 2px solid #444;
            transition: 0.3s;
        }
        .counter-card.active-1 { border-color: #00d4ff; box-shadow: 0 0 15px rgba(0, 212, 255, 0.4); }
        .counter-card.active-2 { border-color: #ff7700; box-shadow: 0 0 15px rgba(255, 119, 0, 0.4); }

        .card-label { font-size: 1.2rem; color: #888; margin-bottom: 10px; }
        .big-number { font-size: 80px; font-weight: 900; line-height: 1; margin: 10px 0; }
        
        .c1-color { color: #00d4ff; }
        .c2-color { color: #ff7700; }

        /* 動態提示文字 */
        #status-text {
          font-size: 1.8rem; color: #ffcc00; font-weight: bold; margin-top: 20px;
          min-height: 2.5rem; text-shadow: 0 0 8px rgba(255, 204, 0, 0.5);
        }
        
        /* 管理員控制區 */
        .admin-panel { margin-top: 30px; padding: 20px; border-top: 1px solid #333; display: none; background: #222; border-radius: 15px; }
        .btn-group { display: flex; gap: 10px; margin-bottom: 15px; }
        button { border: none; padding: 15px; font-size: 1.1rem; font-weight: bold; border-radius: 10px; cursor: pointer; width: 100%; transition: 0.2s; }
        button:active { transform: scale(0.95); }
        
        .btn-next { background: #00ff88; color: #000; margin-bottom: 10px; font-size: 1.3rem; }
        .btn-c1 { background: #00d4ff; color: #000; }
        .btn-c2 { background: #ff7700; color: #000; }
        .btn-back { background: #555; font-size: 0.8rem; color: white; margin-top: 10px; }

        .manual-area { margin: 15px 0; padding-top: 10px; border-top: 1px dashed #444; display: flex; gap: 5px; justify-content: center; }
        input { background: #333; border: 1px solid #444; color: white; padding: 8px; width: 60px; text-align: center; border-radius: 5px; }
    </style>
</head>
<body>

    <div class="header">用電設備檢驗</div>

    <div class="container">
        <div class="display-board">
            <div id="card-1" class="counter-card">
                <div class="card-label">1 號櫃檯</div>
                <div id="num-c1" class="big-number c1-color">--</div>
            </div>
            <div id="card-2" class="counter-card">
                <div class="card-label">2 號櫃檯</div>
                <div id="num-c2" class="big-number c2-color">--</div>
            </div>
        </div>

        <div id="status-text">歡迎光臨</div>

        <div id="admin-box" class="admin-panel">
            <div style="color: #888; margin-bottom: 10px; font-size: 0.9rem;">管理員控制台</div>
            
            <div class="btn-group">
                <button onclick="nextAndCall(1)" class="btn-c1">1號櫃檯 下一位</button>
                <button onclick="nextAndCall(2)" class="btn-c2">2號櫃檯 下一位</button>
            </div>

            <div class="btn-group">
                <button onclick="speakOnly(1)" style="background: #444; color: #00d4ff; font-size: 0.9rem;">1號重撥</button>
                <button onclick="speakOnly(2)" style="background: #444; color: #ff7700; font-size: 0.9rem;">2號重撥</button>
            </div>
            
            <div class="manual-area">
                <input type="number" id="m1" placeholder="1號號碼">
                <button onclick="setManual(1)" style="width: auto; padding: 5px 10px; font-size: 0.8rem;">修改</button>
                <span style="color: #444; margin: 0 10px;">|</span>
                <input type="number" id="m2" placeholder="2號號碼">
                <button onclick="setManual(2)" style="width: auto; padding: 5px 10px; font-size: 0.8rem;">修改</button>
            </div>
        </div>
        
        <p style="font-size: 0.8rem; color: #444; margin-top: 20px;" id="mode-text">客人模式</p>
    </div>

    <script>
        // --- 1. Firebase 設定 ---
        const firebaseConfig = {
            databaseURL: "https://onlinenumber-d0369-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // 分開紀錄兩個櫃檯的號碼
        const refC1 = db.ref('counter1_Number');
        const refC2 = db.ref('counter2_Number');
        const refLastCall = db.ref('lastCalledCounter'); // 紀錄最後是誰叫號

        // --- 2. 監聽數據更新介面 ---
        refC1.on('value', (s) => {
            document.getElementById('num-c1').innerText = s.val() || 0;
            animate(document.getElementById('card-1'));
        });

        refC2.on('value', (s) => {
            document.getElementById('num-c2').innerText = s.val() || 0;
            animate(document.getElementById('card-2'));
        });

        refLastCall.on('value', (s) => {
            const counterNum = s.val();
            const textEl = document.getElementById('status-text');
            if (counterNum) {
                textEl.innerText = `請至 ${counterNum} 號櫃檯辦理`;
                textEl.style.color = (counterNum == 1) ? "#00d4ff" : "#ff7700";
                
                // 視覺高亮當前叫號的櫃檯
                document.getElementById('card-1').classList.toggle('active-1', counterNum == 1);
                document.getElementById('card-2').classList.toggle('active-2', counterNum == 2);
            }
        });

        // --- 3. 管理員功能 ---
        
        // 下一位並語音呼叫
        function nextAndCall(counterNum) {
            const ref = (counterNum === 1) ? refC1 : refC2;
            ref.transaction((current) => {
                const next = (current || 0) + 1;
                // 更新完數字後呼叫語音
                setTimeout(() => speak(next, counterNum), 100);
                return next;
            });
            refLastCall.set(counterNum);
        }

        // 純語音重播（不跳號）
        function speakOnly(counterNum) {
            const num = document.getElementById('num-c' + counterNum).innerText;
            speak(num, counterNum);
            refLastCall.set(counterNum);
        }

        // 手動修改號碼
        function setManual(counterNum) {
            const val = parseInt(document.getElementById('m' + counterNum).value);
            if (!isNaN(val)) {
                const ref = (counterNum === 1) ? refC1 : refC2;
                ref.set(val);
                document.getElementById('m' + counterNum).value = '';
            }
        }

        // --- 4. 輔助功能 ---
        function speak(number, counter) {
            if (number === "--") return;
            window.speechSynthesis.cancel(); // 停止之前的語音防止堆疊
            const msg = new SpeechSynthesisUtterance(`${number} 號，請至 ${counter} 號櫃檯辦理`);
            msg.lang = 'zh-TW';
            msg.rate = 0.9;
            window.speechSynthesis.speak(msg);
        }

        function animate(el) {
            el.style.transform = 'scale(1.05)';
            setTimeout(() => el.style.transform = 'scale(1)', 200);
        }

        // --- 5. 權限判斷 ---
        if (new URLSearchParams(window.location.search).get('admin')) {
            document.getElementById('admin-box').style.display = 'block';
            document.getElementById('mode-text').innerText = '管理員模式';
        }
    </script>
</body>
</html>
